---
import { formatDate, slugify } from "../js/utils";

interface Props {
  article: import("astro:content").CollectionEntry<"articles">;
  index: number;
  page?: {
    total: number;
    start: number;
  };
  hLevel?: `h${2 | 3 | 4 | 5 | 6}`;
}

const { article, index, page, hLevel } = Astro.props;
const { title, category, publishDate, description } = article.data;
const url = `${article.collection}/${article.slug}`;
const Heading = hLevel ?? "h2"; // Alternatively role="heading" and aria-level="[n]" can be used
---

<li aria-setsize={page?.total} aria-posinset={page ? page.start + index + 1 : undefined}>
  <article class="article-card block-shadow" aria-labelledby=`article-card-${index}-title`>
    <Heading id=`article-card-${index}-title` class="h3 mb-4">
      <a href={url}>{title}</a>
    </Heading>
    <p class="ribbon">Posted on {formatDate(publishDate)}</p>
    <p class="content line-clamp-2" set:html={description} />
    <a class="badge" href=`category/${slugify(category)}`>{category}</a>
  </article>
</li>

<style lang="scss">
  .article-card {
    min-height: 160px;
    padding: 16px;
    display: flex;
    flex-direction: column;

    .ribbon {
      font-size: var(--fs-14px);
    }

    .content {
      min-height: 2em; /* Fallback for browsers without lh support */
      min-height: 2lh;
    }

    .badge {
      margin-top: auto;
    }
  }
</style>
